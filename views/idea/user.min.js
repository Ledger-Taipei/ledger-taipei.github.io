var app=app||{};app.Record=Backbone.Model.extend({idAttribute:"_id",url:function(){return"/1/idea"+(this.isNew()?"":"/"+this.id)},defaults:{success:!1,errors:[],errfor:{},idea:"",founder:"",description:"",facebook:"",github:"",twitter:"",email:"",time:"",isActive:!0}}),app.RecordCollection=Backbone.Collection.extend({model:app.Record,url:"/1/idea",parse:function(a){return app.pagingView.model.set({pages:a.pages,items:a.items}),app.filterView.model.set(a.filters),a.data}}),app.Filter=Backbone.Model.extend({defaults:{search:"",status:"",sort:"",limit:""}}),app.Paging=Backbone.Model.extend({defaults:{pages:{},items:{}}}),app.UserIdea=Backbone.Model.extend({url:"/1/idea",defaults:{errors:[],errfor:{},ideas:[]}}),app.UserIdeaView=Backbone.View.extend({el:"#ideas",template:_.template($("#tmpl-idea-item").html()),events:{},initialize:function(){this.model=new app.Idea,this.listenTo(this.model,"sync",this.render),this.listenTo(this.model,"change",this.render),this.listUserIdeas()},requestInvalidate:function(){},render:function(){this.$el.html(this.template(this.model.toJSON())),$(".btn-publish").each(function(){var a=$(this),b=function(){var b=" 設為公開",c=" 設為非公開",d=a.data("idea-id"),e=a.data("toggle"),f="/1/idea/"+d;a.text(" Saving..."),$.ajax("publish"===e?{type:"PUT",url:f+"/publish",success:function(b){b.success&&(a.text(c),a.data("toggle","unpublish"),$.notify("你的 Pitch 已公開在網站上。",{position:"bottom right",className:"success"}))}}:{type:"PUT",url:f+"/unpublish",success:function(c){c.success&&(a.text(b),a.data("toggle","publish"),$.notify("你的 Pitch 將不會公開在網站上。",{position:"bottom right",className:"error"}))}}),requestInvalidate()};a.on("click",function(){b()})})},listUserIdeas:function(){var a=this;$.ajax({type:"GET",url:"/1/idea",data:"",success:function(b){b.success&&a.model.set("ideas",b.data)}})}}),$(document).ready(function(){app.userIdeaView=new app.UserIdeaView});
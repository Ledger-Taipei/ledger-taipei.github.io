var app=app||{};app.Post=Backbone.Model.extend({url:function(){return"/1/post"},defaults:{errors:[],errfor:{},subject:"",content:"",html:""},converter:{},editor:{},parse:function(){converter=new Showdown.converter;var a=converter.makeHtml(this.get("content"));return this.set("html",a),!0},editable:function(){editor=new MediumEditor(".editable",{anchorInputPlaceholder:"輸入網址",buttons:["bold","italic","underline","anchor","header1","header2","quote"],diffLeft:0,diffTop:-5,firstHeader:"h1",secondHeader:"h2",delay:100,targetBlank:!0})},serialize:function(){var a=editor.serialize().post.value;this.set("html",a),this.set("content",html2markdown(a))}}),app.PostsView=Backbone.View.extend({el:".wiki-content",content:$('[data-tag="markdown"]').html(),events:{"click .btn-post-save":"save","click .btn-post-edit":"edit"},initialize:function(){this.model=new app.Post,this.template=_.template($("#tmpl-post").html());var a=this.$el.find('[data-tag="subject"]').data("post-subject"),b=this.$el.find('[data-tag="id"]').data("post-id");this.model.set("subject",a),this.model.set("content",this.content),this.model.set("id",b),this.render()},render:function(){this.model.parse();var a=this.$el.find(".wiki-date");a.html(moment(a.text()).fromNow()),this.$el.find("#post").html(this.template(this.model.toJSON()))},edit:function(){this.editable(),this.$el.find(".btn-post-save").removeClass("hide")},save:function(){this.model.serialize(),this.model.save(),$.notify("已儲存成功","success")},editable:function(){this.model.editable()}}),app.MainView=Backbone.View.extend({initialize:function(){app.mainView=this,app.PostsView=new app.PostsView}}),$(document).ready(function(){app.mainView=new app.MainView,$(".btn-facebook").hover(function(){},function(){})});
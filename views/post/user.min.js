var app=app||{};app.Post=Backbone.Model.extend({url:"/1/post",defaults:{errors:[],errfor:{},posts:[]}}),app.UserPostView=Backbone.View.extend({el:"#posts",template:_.template($("#tmpl-post-item").html()),events:{},initialize:function(){this.model=new app.Post,this.listenTo(this.model,"sync",this.render),this.listenTo(this.model,"change",this.render),this.listUserPosts(),this.render()},render:function(){this.$el.html(this.template(this.model.attributes)),$(".btn-publish-post").each(function(){var a=$(this),b=function(){var b=" Publish (將文章公開)",c=" Unpublish (將文章下線)",d=a.data("post-subject"),e=a.data("toggle"),f="/1/post/"+d;a.text(" Saving..."),$.ajax("publish"===e?{type:"PUT",url:f+"/publish",success:function(b){b.success&&(a.text(c),a.data("toggle","unpublish"),$.notify("文章已公開在網站上。",{position:"bottom right",className:"success"}))}}:{type:"PUT",url:f+"/unpublish",success:function(c){c.success&&(a.text(b),a.data("toggle","publish"),$.notify("文章將暫時下線，重新 Publish 即可公開在網站上。",{position:"bottom right",className:"error"}))}})};a.on("click",function(){b()})})},listUserPosts:function(){var a=this;$.ajax({type:"GET",url:"/1/post",data:"",success:function(b){b.success&&a.model.set("posts",b.posts)}})}}),$(document).ready(function(){app.userPostView=new app.UserPostView});